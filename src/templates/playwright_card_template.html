{% extends "minimal.html" %}

{% block title %}{{ title }}{% endblock %}

{% block page_styles %}
<style>
    /* 页面容器 */
    .page {
        width: 210mm;  /* A4宽度 */
        height: 297mm; /* A4高度 */
        margin: 0;
        padding: 0;
        page-break-after: always;
        position: relative;
        background-color: white;
    }

    .page.landscape {
        width: 297mm;  /* A4横版宽度 */
        height: 210mm; /* A4横版高度 */
    }

    .page:last-child {
        page-break-after: avoid;
    }

    /* 单页布局 */
    .single-layout .card {
        width: 200mm;
        height: 287mm;
        border: 2px solid #000;
    }

    /* A4八卡片布局 */
    .a4-8-layout {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 4mm;
        padding: 8mm;
        height: 100%;
        width: 100%;
    }

    .a4-8-layout.back-page {
        transform: scaleX(-1);
    }

    .a4-8-layout .card {
        width: 65mm;
        height: 85mm;
        border: 1px solid #000;
    }

    @media print {
        @page {
            margin: 0;
            size: A4 landscape;
        }
        body {
            margin: 0;
            padding: 0;
        }
        .page {
            margin: 0;
            padding: 0;
            page-break-after: always;
        }
        .page:last-child {
            page-break-after: avoid;
        }
    }
</style>
{% endblock %}

{% block body_content %}
{% if layout == 'single' %}
    {% for card in cards %}
    <div class="page">
        <div class="single-layout">
            <div class="card">
                <div class="card-front">
                    <div class="card-content">{{ card.front | safe }}</div>
                </div>
            </div>
        </div>
    </div>
    <div class="page">
        <div class="single-layout">
            <div class="card">
                <div class="card-back">
                    <div class="card-content">{{ card.back | safe }}</div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
{% else %}
    {% set cards_per_page = 8 %}
    {% for page_start in range(0, cards | length, cards_per_page) %}
    {% set page_cards = cards[page_start:page_start + cards_per_page] %}
    <div class="page landscape">
        <div class="a4-8-layout">
            {% for card in page_cards %}
            <div class="card">
                <div class="card-side card-front">
                    <div class="card-content">{{ card.front | safe }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="page landscape">
        <div class="a4-8-layout back-page">
            {% for card in page_cards %}
            <div class="card">
                <div class="card-side card-back">
                    <div class="card-content">{{ card.back | safe }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
{% endif %}
{% endblock %}

{% block scripts %}
{% endblock %}