# FastMCP 和 UV 管理包配置文档

## 1. UV 包管理器

### 1.1 UV 简介

UV 是一个快速、现代化的 Python 包管理器，提供了比 pip 更快的包安装速度和更简洁的用户体验。

### 1.2 安装 UV

在 macOS 上安装 UV：

```bash
# 使用 Homebrew 安装
brew install uv

# 或者使用 pip 安装
pip install uv
```

### 1.3 基本使用

```bash
# 创建虚拟环境
uv venv

# 激活虚拟环境
source .venv/bin/activate

# 安装包
uv install package_name

# 安装多个包
uv install package1 package2

# 安装指定版本的包
uv install package_name==1.0.0

# 从 requirements.txt 安装
uv install -r requirements.txt

# 导出已安装的包
uv pip freeze > requirements.txt

# 卸载包
uv uninstall package_name

# 更新包
uv update package_name
```

### 1.4 配置

UV 的配置文件通常位于 `~/.config/uv/config.toml`，可以通过编辑此文件来自定义 UV 的行为。

常见配置选项：

```toml
[uv]
# 设置默认的 Python 版本
default-python = "3.11"

# 设置包索引源
index-url = "https://pypi.org/simple"

# 设置额外的包索引源
[uv.extra-index-urls]
private = "https://pypi.example.com/simple"

# 设置信任的主机
[uv.trusted-hosts]
example = "pypi.example.com"
```

## 2. FastMCP

### 2.1 FastMCP 简介

FastMCP 是一个用于构建微控制程序（MCP）的快速框架，专为处理特定任务而设计，提供了简洁的 API 和高效的执行环境。

### 2.2 安装 FastMCP

使用 UV 安装 FastMCP：

```bash
uv install fastmcp
```

### 2.3 基本使用

以下是一个基本的 FastMCP 程序示例：

```python
from fastmcp import FastMCP, MCPRequest, MCPResponse

# 创建 MCP 实例
mcp = FastMCP()

# 定义处理函数
@mcp.handler("process_data")
def process_data(request: MCPRequest) -> MCPResponse:
    # 从请求中获取数据
    data = request.get_data()
    
    # 处理数据
    # ... 处理逻辑 ...
    
    # 返回响应
    return MCPResponse.success(result=data)

# 运行 MCP
if __name__ == "__main__":
    mcp.run()
```

### 2.4 配置 FastMCP

FastMCP 支持通过环境变量或配置文件进行配置：

```python
# 通过代码配置
mcp = FastMCP(
    host="0.0.0.0",
    port=8000,
    debug=True,
    max_workers=4
)

# 通过环境变量配置
# FAST_MCP_HOST=0.0.0.0
# FAST_MCP_PORT=8000
# FAST_MCP_DEBUG=true
# FAST_MCP_MAX_WORKERS=4
```

### 2.5 日志配置

FastMCP 使用 Python 的标准 logging 模块，可以通过以下方式配置：

```python
import logging

# 配置日志级别
logging.basicConfig(level=logging.INFO)

# 或者配置更详细的日志
logger = logging.getLogger("fastmcp")
handler = logging.StreamHandler()
formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
handler.setFormatter(formatter)
logger.addHandler(handler)
logger.setLevel(logging.INFO)
```

## 3. 项目配置

### 3.1 创建项目结构

```
FlashCardMCP/
├── project_docs/
│   ├── PRD.md
│   └── 技术配置.md
├── src/
│   ├── __init__.py
│   ├── main.py
│   ├── handlers/
│   │   ├── __init__.py
│   │   └── card_generator.py
│   ├── utils/
│   │   ├── __init__.py
│   │   ├── markdown_parser.py
│   │   └── json_validator.py
│   └── templates/
│       ├── __init__.py
│       └── card_template.html
├── tests/
│   ├── __init__.py
│   ├── test_handlers.py
│   └── test_utils.py
├── .venv/
├── requirements.txt
└── README.md
```

### 3.2 创建 requirements.txt

```
fastmcp>=1.0.0
markdown>=3.4.0
pydantic>=2.0.0
jinja2>=3.0.0
uvicorn>=0.20.0
```

### 3.3 使用 UV 初始化项目

```bash
# 创建虚拟环境
uv venv

# 激活虚拟环境
source .venv/bin/activate

# 安装依赖
uv install -r requirements.txt
```

## 4. 开发工作流程

1. **环境准备**：安装 UV 和 FastMCP，创建虚拟环境
2. **代码开发**：实现 JSON 解析、Markdown 转换和闪卡生成逻辑
3. **测试验证**：编写并运行测试用例，确保功能正常
4. **性能优化**：优化代码性能，满足性能要求
5. **部署配置**：准备部署环境和配置文件
6. **文档编写**：完善 API 文档和使用说明

## 5. 常见问题与解决方案

### 5.1 包安装失败

如果遇到包安装失败的情况，可以尝试以下解决方案：

```bash
# 清除 UV 缓存
uv cache clean

# 使用不同的包源
uv install package_name --index-url https://pypi.org/simple

# 检查网络连接
ping pypi.org
```

### 5.2 FastMCP 启动失败

检查以下可能的原因：

- 端口被占用：尝试使用不同的端口
- 配置文件错误：检查配置文件中的语法错误
- 依赖缺失：确保所有依赖都已正确安装

### 5.3 性能问题

如果遇到性能问题，可以尝试以下优化：

- 增加工作进程数量
- 优化 Markdown 转换逻辑
- 使用缓存减少重复计算
- 调整服务器参数提高并发处理能力